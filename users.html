<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Users Management</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>

<!-- TOP NAVBAR -->
<nav class="nav-area navbar navbar-expand-lg navbar-dark px-3">
  <span class="toggle-btn me-3">
    <i class="fa fa-bars"></i>
  </span>

  <a class="navbar-brand" href="#">Admin Dashboard</a>

  <div class="ms-auto d-flex">
    <span class="text-white me-3">Welcome, Admin</span>
    <button class="btn btn-outline-light btn-sm">Logout</button>
  </div>
</nav>

<!-- SIDEBAR -->
<div class="sidebar">
  <span>&times;</span>
  <h2>Admin Dashboard</h2>

  <a href="index.html"><i class="fa fa-home me-2"></i> Dashboard</a>
  <a href="users.html" class="bg-dark text-white"><i class="fa fa-users me-2"></i> Users</a>
  <a href="#"><i class="fa fa-camera me-2"></i> Photographers</a>
  <a href="#"><i class="fa-solid fa-icons"></i>&nbsp;&nbsp; ServiceCategory</a>
  <a href="#"><i class="fa-solid fa-box"></i>&nbsp;&nbsp; Packages</a>
  <a href="#"><i class="fa-solid fa-check-to-slot"></i>&nbsp;&nbsp; TimeSlot</a>
  <a href="#"><i class="fa-brands fa-searchengin"></i>&nbsp;&nbsp; Reviews</a>
  <a href="#"><i class="fa fa-book me-2"></i> Bookings</a>
  <a href="#"><i class="fa fa-money-bill me-2"></i> Payments</a>
  <a href="#"><i class="fa fa-gear me-2"></i> Settings</a>
</div>

<!-- MAIN CONTENT -->
<div class="content-area" id="content">

  <h3 class="fw-bold mb-4">User Management</h3>

  <!-- Top section -->
  <div class="d-flex justify-content-between mb-3">
    <input type="text" id="searchBar" class="form-control w-50" placeholder="Search user...">
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addModal">+ Add User</button>
  </div>

  <!-- User Table -->
  <div class="card shadow-sm">
    <div class="card-body p-0 table-responsive">
      <table class="table table-striped mb-0">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
            <th>Status</th>
            <th width="220">Actions</th>
          </tr>
        </thead>
        <tbody id="userTable"></tbody>
      </table>
    </div>
  </div>

</div>


<!-- =================== MODALS =================== -->

<!-- ADD USER -->
<div class="modal fade" id="addModal">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5>Add New User</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <input id="addName" class="form-control mb-2" placeholder="Full Name">
        <input id="addEmail" class="form-control mb-2" placeholder="Email">

        <select id="addRole" class="form-select mb-2">
          <option>Client</option>
          <option>Photographer</option>
        </select>

        <select id="addStatus" class="form-select mb-3">
          <option>Active</option>
          <option>Blocked</option>
        </select>

        <button class="btn btn-primary w-100" onclick="addUser()">Add User</button>
      </div>

    </div>
  </div>
</div>

<!-- EDIT USER -->
<div class="modal fade" id="editModal">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5>Edit User</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <input id="editId" type="hidden">
        <input id="editName" class="form-control mb-2">
        <input id="editEmail" class="form-control mb-2">

        <select id="editRole" class="form-select mb-2">
          <option>Client</option>
          <option>Photographer</option>
        </select>

        <select id="editStatus" class="form-select mb-3">
          <option>Active</option>
          <option>Blocked</option>
        </select>

        <button class="btn btn-warning w-100" onclick="updateUser()">Save Changes</button>
      </div>

    </div>
  </div>
</div>

<!-- VIEW USER -->
<div class="modal fade" id="viewModal">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5>User Details</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body" id="viewBody"></div>

    </div>
  </div>
</div>

<!-- DELETE MODAL -->
<div class="modal fade" id="deleteModal">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header bg-danger text-white">
        <h5>Delete User</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <p>Are you sure you want to delete this user?</p>
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-danger" onclick="confirmDelete()">Delete</button>
      </div>

    </div>
  </div>
</div>


<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- =================== JAVASCRIPT CRUD + SIDEBAR =================== -->
<script>

  /* ------------ SIDEBAR TOGGLE ------------ */
  let icon = document.querySelector(".fa-bars");
  let navarea = document.querySelector(".sidebar");
  let closenav = document.querySelector(".sidebar span");

  icon.addEventListener("click", () => {
    navarea.classList.toggle("active");
  });

  closenav.addEventListener("click", () => {
    navarea.classList.remove("active");
  });


  /* ------------ CRUD LOGIC ------------ */

  let deleteID = null;

  function loadUsers() {
    let users = JSON.parse(localStorage.getItem("users")) || [];
    let table = document.getElementById("userTable");
    table.innerHTML = "";

    users.forEach(user => {
      table.innerHTML += `
        <tr>
          <td>${user.id}</td>
          <td>${user.name}</td>
          <td>${user.email}</td>
          <td>${user.role}</td>
          <td><span class="badge bg-${user.status === 'Active' ? 'success' : 'danger'}">${user.status}</span></td>
          <td>
            <button class="btn btn-info btn-sm" onclick="viewUser(${user.id})">View</button>
            <button class="btn btn-warning btn-sm" onclick="editUser(${user.id})">Edit</button>
            <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})">Delete</button>
          </td>
        </tr>
      `;
    });
  }

  function addUser() {
    let users = JSON.parse(localStorage.getItem("users")) || [];

    let newUser = {
      id: Date.now(),
      name: document.getElementById("addName").value,
      email: document.getElementById("addEmail").value,
      role: document.getElementById("addRole").value,
      status: document.getElementById("addStatus").value
    };

    users.push(newUser);
    localStorage.setItem("users", JSON.stringify(users));

    document.getElementById("addName").value = "";
    document.getElementById("addEmail").value = "";

    loadUsers();
    document.querySelector("#addModal .btn-close").click();
  }

  function viewUser(id) {
    let users = JSON.parse(localStorage.getItem("users")) || [];
    let user = users.find(u => u.id === id);

    document.getElementById("viewBody").innerHTML = `
      <p><strong>ID:</strong> ${user.id}</p>
      <p><strong>Name:</strong> ${user.name}</p>
      <p><strong>Email:</strong> ${user.email}</p>
      <p><strong>Role:</strong> ${user.role}</p>
      <p><strong>Status:</strong> ${user.status}</p>
    `;

    new bootstrap.Modal(document.getElementById("viewModal")).show();
  }

  function editUser(id) {
    let users = JSON.parse(localStorage.getItem("users")) || [];
    let user = users.find(u => u.id === id);

    document.getElementById("editId").value = user.id;
    document.getElementById("editName").value = user.name;
    document.getElementById("editEmail").value = user.email;
    document.getElementById("editRole").value = user.role;
    document.getElementById("editStatus").value = user.status;

    new bootstrap.Modal(document.getElementById("editModal")).show();
  }

  function updateUser() {
    let users = JSON.parse(localStorage.getItem("users")) || [];
    let id = Number(document.getElementById("editId").value);

    users = users.map(user =>
      user.id === id ? {
        ...user,
        name: document.getElementById("editName").value,
        email: document.getElementById("editEmail").value,
        role: document.getElementById("editRole").value,
        status: document.getElementById("editStatus").value
      } : user
    );

    localStorage.setItem("users", JSON.stringify(users));
    loadUsers();
    document.querySelector("#editModal .btn-close").click();
  }

  function deleteUser(id) {
    deleteID = id;
    new bootstrap.Modal(document.getElementById("deleteModal")).show();
  }

  function confirmDelete() {
    let users = JSON.parse(localStorage.getItem("users")) || [];
    users = users.filter(u => u.id !== deleteID);

    localStorage.setItem("users", JSON.stringify(users));
    loadUsers();

    document.querySelector("#deleteModal .btn-close")?.click();
  }

  document.getElementById("searchBar").addEventListener("keyup", function () {
    let value = this.value.toLowerCase();
    let rows = document.querySelectorAll("#userTable tr");

    rows.forEach(row => {
      let name = row.cells[1].innerText.toLowerCase();
      let email = row.cells[2].innerText.toLowerCase();

      row.style.display = (name.includes(value) || email.includes(value)) ? "" : "none";
    });
  });

  loadUsers();

</script>

</body>
</html>
